<div class="container mt-4">

  <h3 class="text-secondary mb-4">
    {{ isEditMode ? 'Editar Receta âœï¸' : 'Nueva Receta ğŸ“˜' }}
  </h3>

  <form [formGroup]="recipeForm" (ngSubmit)="save()">

    <!-- PRODUCTO ASOCIADO -->
    <div class="mb-3">
      <label class="form-label">Producto</label>
      <select class="form-control" formControlName="productId">
        <option value="" disabled>Seleccione producto</option>
        <option *ngFor="let p of products" [value]="p.id">
          {{ p.name }}
        </option>
      </select>
    </div>

    <!-- DESCRIPCIÃ“N -->
    <div class="mb-3">
      <label class="form-label">DescripciÃ³n</label>
      <textarea
        class="form-control"
        rows="2"
        placeholder="Ej: Receta estÃ¡ndar para producciÃ³n"
        formControlName="description">
      </textarea>
    </div>

    <hr>

    <!-- DETALLES DE INGREDIENTES -->
    <h5 class="text-warning">Ingredientes</h5>

    <div formArrayName="details">
      <div
        class="card p-3 mt-3 shadow-sm"
        *ngFor="let detail of details.controls; let i = index"
        [formGroupName]="i">

        <div class="row">

          <!-- INGREDIENTE -->
          <div class="col-md-5">
            <label class="form-label">Ingrediente</label>
            <select class="form-control" formControlName="ingredientId">
              <option value="">Seleccione</option>
              <option *ngFor="let ing of ingredients" [value]="ing.id">
                {{ ing.name }}
              </option>
            </select>
          </div>

          <!-- CANTIDAD -->
          <div class="col-md-4">
            <label class="form-label">Cantidad</label>
            <input type="number" class="form-control" formControlName="quantity" min="0" step="0.01">
          </div>

          <!-- UNIDAD (solo lectura) -->
          <div class="col-md-2 d-flex align-items-end">
            <span class="badge bg-secondary p-2">
              {{ getUnitName(detail.value.ingredientId) }}
            </span>
          </div>

          <!-- ELIMINAR -->
          <div class="col-md-1 d-flex align-items-end">
            <button type="button" class="btn btn-danger btn-sm" (click)="removeDetail(i)">ğŸ—‘ï¸</button>
          </div>

        </div>
      </div>
    </div>

    <!-- BOTÃ“N AÃ‘ADIR INGREDIENTE -->
    <button type="button" class="btn btn-outline-warning mt-3" (click)="addDetail()">
      â• AÃ±adir ingrediente
    </button>

    <hr>

    <!-- BOTONES -->
    <button type="submit" class="btn btn-primary">
      ğŸ’¾ {{ isEditMode ? 'Actualizar' : 'Guardar' }}
    </button>
    <a routerLink="/recipes" class="btn btn-secondary ms-2">
      â†© Volver
    </a>

  </form>
  <br>
</div>
